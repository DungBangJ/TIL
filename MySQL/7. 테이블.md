# 테이블
## 테이블 만들 때 생기는 오류
테이블을 만들면서 외래 키에 대해서 오류가 발생할 수 있다.
- 만약 회원 테이블과 구매 테이블이 외래 키로 연결되어 있다면,
  - 구매 테이블의 userid의 값은 반드시 회원 테이블의 userID로 존재 해야 한다는 의미이다.
  - 회원 테이블에 userid가 없는 상태에서 구매 테이블에 갑자기 userID가 들어왔는데 이것을 외래 키로 연결 했다면, 회원가입을 하지 않고 구매를 한 것과 같으므로 오류가 생기는 것이다.
    - 이럴 때는 구매 테이블에서 문제를 일으키는 행을 지우고 Apply 하면 된다.

## SQL로 테이블 생성
```SQL
CREATE TABLE test
(
    num INT
);
```

```sql
DROP DATABASE tabledb;
CREATE DATABASE tabledb;

USE tabledb;
DROP TABLE IF EXISTS buytbl, usertbl;
CREATE TABLE usertbl -- 회원 테이블
(
    userID CHAR(8) NOT NULL PRIMARY KEY,
    name VARCHAR(10) NOT NULL,
    birthYear INT NOT NULL,
    addr CHAR(2) NOT NULL,
    mobile1 CHAR(3) NULL,
    mobile2 CHAR(8) NULL,
    height SMALLINT NULL,
    mDate DATE NULL
);

CREATE TABLE buytbl
(
    num INT AUTO_INCREMENT NOT NULL PRIMARY KEY,
    userid CHAR(8) NOT NULL,
    prodName CHAR(6) NOT NULL,
    groupName CHAR(4) NULL,
    price INT NOT NULL,
    amount SMALLINT NOT NULL,
    FOREIGN KEY(userid) REFERENCES usertbl(userID)
);
```

```SQL
INSERT INTO usertbl VALUES
('LSG', '이승기', 1987, '서울', '011', '1111111', 182, '2008-8-8'),
('KBS', '김범수', 1979, '경남', '011', '2222222', 173, '2012-4-4'),
('KHH', '김경호', 1971, '전남', '019', '3333333', 177, '2007-7-7');

INSERT INTO buytbl VALUES (NULL, 'KBS', '운동화', NULL, 30, 2);
INSERT INTO buytbl VALUES (NULL, 'KBS', '노트북', '전자', 1000, 1);
INSERT INTO buytbl VALUES (NULL, 'JYP', '모니터', '전자', 200, 1);
```

- 이렇게 값을 입력하면 오류가 발생한다.
  - JYP는 아직 회원 테이블에 존재하기 않기 때문이다.

## 제약(constraint) 조건
데이터의 무결성을 지키기 위한 제한된 조건을 의미
- 어떤 조건을 만족했을 때 입력되도록 제약한다.

### 기본 키 제약 조건
기본 키(PRIMARY KEY)
- 테이블에 존재하는 많은 행의 데이터를 구분할 수 있는 식별자
- 중복 불가능, NULL 불가능
- 자동으로 클러스터형 인덱스 생성
- 두 개의 열을 합쳐서 기본 키로 설정 가능
- 기본 키에 이름을 붙여줄 수도 있다.
```SQL
CONSTRAINT PRIMARY KEY PK_userID(userID)
-- CONSTRAINT는 생략 가능하다.
```
- PK_userID라는 이름으로 바꾼 것이다.
  - FOREIGN KEY는 하나의 테이블에 여러 개가 생성될 수 있으므로 PRIMARY KEY의 이름을 지정하면 관리하는 것이 편리해진다.
    - SHOW KEYS FROM 테이블이름;
      - 이 구문을 사용하면 테이블에 지정된 키를 볼 수 있다.

ALTER TABLE
- 이미 만들어진 테이블을 수정

```SQL
ALTER TABLE userTBL
    ADD CONSTRAINT PK_userTBL_userID
    PRIMARY KEYT (userID);
```
- CREATE TABLE안에 PRIMARY KEY문으로 설정한 것과 나중에 ALTER TABLE로 PRIMARY KEY를 지정하는 것은 같은 것이다.
- 의미
  - ALTER TABLE usertbl
    - usertbl을 변경하자
  - ADD CONSTRAINT PK_usertbl_userID
    - 제약 조건을 추가하자.
    - 제약 조건의 이름은 'PK_usertbl_userID'이다.
  - PRIMARY KEY (userID);
    - 추가할 제약 조건은 기본 키 제약 조건이다.
    - 제약 조건을 설정할 열은 userID열이다.

```sql
ALTER TABLE prodTbl
    ADD CONSTRAINT PK_prodTbl_proCode_prodID
        PRIMARY KEY (prodCode, prodID)
```
- 두 열을 합쳐서 하나의 기본 키로 설정했다.
  - 제약 조건의 이름은 'PK_prodTbl_proCode_prodID'이다.

CREATE문에도 사용할 수 있다.
```SQL
CONSTRAINT PK_prodTbl_proCode_prodID
    PRIMARY KEY (prodCode, prodID)
```
- 이 구문을 그냥 평상시 PRIMARY KEY를 마지막에 선언하듯이 마지막에 붙여주면 된다. 

```SQL
SHOW INDEX FROM prodTbl
```
- 테이블의 정보를 확인할 수 있다.
  - 두 열이 합쳐져서 하나의 기본 키 제약 조건을 설정하고 있음을 확인 가능