- [물리 서버](#물리-서버)
  - [서버 외관과 설치 장소](#서버-외관과-설치-장소)
  - [서버 내부 구성](#서버-내부-구성)
- [CPU](#cpu)
- [메모리](#메모리)
- [I/O 장치](#io-장치)
  - [HDD](#hdd)
  - [네트워크 인터페이스](#네트워크-인터페이스)
  - [I/O 제어](#io-제어)
- [버스](#버스)
  - [대역](#대역)
  - [버스 대역](#버스-대역)

---

# 물리 서버

## 서버 외관과 설치 장소

Rack에 장착
- 서버
- HDD가 장착돼 있는 저장소
- 인터넷 및 LAN을 연결하기 위하 네트워크 스위치

## 서버 내부 구성

내부의 컴포넌트를 연결하느 선을 Bus라고 한다.

CPU와 메모리는 물리적으로 직접 연결된다.

PCI Express
- 외부 장치를 연결하는 슬론

CPU ~ USB 네트워크 인터페이스(NIC) > CPU ~ 메모리

BMC(Baseboard Management Controller)
- 서버의 H/W 상태 감시
- 독립적으로 움직인다.

서버와 PC는 물리적으로 기본 구성이 같다.
- 차이점
  - 전원 이중화 -> 장애에 강함
  - 대용량 CPU나 메모리 탑재

---

# CPU

Central Processing Unit
- 서버 중심에 위치해 연산 처리를 실시하고 결과를 반환
- 표면
  - 대량의 전기 신호를 처리하기 때문에 발열이 심하다.
    - 표면에 냉각기 설치
- 뒷면
  - 대량의 핀이 버스에 연결돼 있어서 메모리나 디스크와 데이터를 교환
- 하나의 CPU에는 여러 개의 Core가 있다.
  - 멀티 코어
  - 각각의 코어는 독립된 처리
- 명령과 데이터는 기억 장치나 입출력 장치를 통해 전달된다.
  - 명령이나 데이터는 기억 장치에 있지만 명령은 운영체제(OS, Operating System)가 내린다.
    - OS에 누가 명령?
      - OS에서 동작하는 웹 서버나 데이터베이스의 실체인 '프로세스'와 사용자 키보드, 마우스 등을 통한 입력이다.

---

# 메모리

CPU 옆에 위치
- CPU에 전달하는 내용이나 데이터를 저장하거나 처리 결과를 받는다.

메모리에 저장되는 정보는 휘발성
- 그럼에도 쓰는 이유
  - 빠른 메모리 액세스
  - 전기적인 처리만으로도 데이터를 저장

CPU 내부에도 메모리가 존재
- 레지스터나 L1/L2 캐시라고 불린다.
- 메모리보다 빠르다.
  - but 용량이 매우 작다.
- 메모리 영역이 여러 개인 이유
  - 메모리를 이용하려면 메모리 컨트롤러를 경유해서 일단 CPU 밖으로 나가야한다.
    - 고속 CPU에서는 여기서 생기는 처리 지연(Latency)을 허락하지 않는다.
    - Latency를 줄이기 위해 메모리 영역이 여러 개인 것
      - 처리 지연을 줄이기 위해 가장 자주 사용하는 명령/데이터를 코어 가까운 곳에 배치
      - L1
        - 초고속 캐시
        - 각 코어 전용
      - L2
        - 고속 캐시
        - 각 코어 전용
      - Ln
        - 준고속 캐시
        - CPU 전체가 공유

Memory Interleaving
- 메모리가 CPU의 처리 지연을 줄이기 위해 미리 데이터를 CPU에 전달

채널
- 메모리 컨트롤러 내부에 최대 3개 존재
- 데이터 1을 요구하면 데이터2, 3도 함께 보낸다.
  - 대부분의 데이터가 연속해서 엑세스 된다는 규칙을 기반으로 만들어진 것
  - 앞의 채널이 도착한다면 먼저 읽어서 처리 지연을 줄인다.

---

# I/O 장치

## HDD

장기 저장 목적의 데이터 저장소
- 디스크는 전기가 없어도 데이터가 사라지지 않는다.

회전 구조
- 속도가 물리 법칙에 좌우
- 메모리처럼 순식간에 엑세스할 수 없다.

SDD
- Solid State Disk, 반도체 디스크
- 메모리와 같이 반도체로 만들어졌지만, 전기가 없어도 데이터가 사라지지 않는다.

Storage
- 저장소
- HDD가 많이 탑재되어 있는 하드웨어
- I/O의 서브 시스템
- CPU와 캐시가 존재
- 서버와 I/O 시에는 데이터 교환을 캐시를 통해서 한다.
  - 읽기 캐시의 경우
    - 캐시에 있다.
      - 캐시에서 데이터 꺼냄
    - 캐시에 없다.
      - 디스크에서 읽어 캐시에 올리고 이를 서버에 반환
  - 쓰기 캐시의 경우
    - 캐시와 저장소에 기록하고 I/O를 종료했다고 서버에 알림
    - 캐시에만 데이터를 기록하면 데이터를 읽을 가능성이 있다.
      - 대부분의 저장소 제품에서는 이 캐시를 별도의 캐시와 미러링해서 안정성 향상
  - write-through
    - 바로 쓰기
    - 캐시와 하위 저장소에 동시에 쓰는 방식
  - write-back
    - 나중에 쓰기
    - 캐시에만 썼다가, 캐시에서 밀려날 때 하위 저장소에 저장하는 방식
    - 처음에 캐시 데이터만 갱신하므로 매우 빠르다.
    - 기본적으로 캐시의 장점을 살리기 위해 write-back 사용
- Fiber Channel(FC)
  - 대형 저장소와 서버를 연결할 때 FC 케이블을 사용해서 SAN(Storage Area Network)을 경유한다.
  - FC 포트
    - SAN에 접속하기 위한 파이버 채널 인터페이스
  - 보통은 서버 시스템 포트에 FC 포트가 없어서 PCI 슬롯에 HBA 카드를 삽입한다.

## 네트워크 인터페이스

서버와 외부장비를 연결하기 위한 외부 접속용 인터페이스
- 외부 장비
  - 네트워크에 연결된 다른 서버
  - 저장소 장치

## I/O 제어

PCI의 x8, x16
- PCI의 I/O 회선이 몇 개 연결되는지를 의미

CPU가 처리할 수 있는 총량 = PCI(외부적인 용도 + 내부적인 용도)

CPU 외에도 여러 컨트롤러나 칩이 있는 이유
- CPU가 해야할 일에 더 집중하기 위해서
  - 역할 분담
  - I/O 시에 고간련 처리를 가능한 I/O와 가까운 곳에서 처리하는 것이 효율적이다.
    - CPU와 먼 곳

---

# 버스

서버 내부에 있는 컴포넌트들을 서로 연결시키는 회선

## 대역

Throughput, 처리량

데이터 전송 능력
- 한번에 데이터를 보낼 수 있는 데이터의 전송폭 * 1초에 전송할 수 있는 전송 횟수

## 버스 대역

CPU에 가까운 쪽이 1초당 전송량이 크다.
- CPU와 메모리는 대량으로 데이터를 교환해서 매우 빠른 전송 능력이 요구되기 때문

병목현상
- Bottleneck
- 데이터 전송이 어떤 이유로 막혀 있는 상태
