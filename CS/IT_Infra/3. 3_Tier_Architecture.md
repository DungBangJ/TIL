- [3계층형 시스템](#3계층형-시스템)
- [주요 개념 설명](#주요-개념-설명)
	- [프로세스와 스레드](#프로세스와-스레드)
	- [OS 커널](#os-커널)
		- [시스템 콜 인터페이스](#시스템-콜-인터페이스)
		- [프로세스 관리](#프로세스-관리)
		- [메모리 관리](#메모리-관리)
		- [파일 시스템 관리](#파일-시스템-관리)
		- [장치 드라이버](#장치-드라이버)
- [웹 데이터의 흐름](#웹-데이터의-흐름)
	- [클라이언트 PC부터 웹 서버까지](#클라이언트-pc부터-웹-서버까지)
	- [웹 서버부터 AP 서버까지](#웹-서버부터-ap-서버까지)
	- [AP 서버부터 DB 서버까지](#ap-서버부터-db-서버까지)
	- [AP 서버부터 웹 서버까지](#ap-서버부터-웹-서버까지)
	- [웹 서버로부터 클라이언트 PC까지](#웹-서버로부터-클라이언트-pc까지)
	- [웹 데이터의 흐름 정리](#웹-데이터의-흐름-정리)
- [가상화](#가상화)
	- [가상화란?](#가상화란)
	- [OS도 가상화 기술의 하나](#os도-가상화-기술의-하나)
	- [가상 머신](#가상-머신)
	- [컨테이너](#컨테이너)

---

# 3계층형 시스템

주요 구성 요소

- 웹 서버
- AP 서버
- DB 서버

---

# 주요 개념 설명

## 프로세스와 스레드

프로세스

- 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램

프로그램 vs 프로세스

- 프로그램
  - 일반적으로 하드 디스크 등에 저장되어 있는 실행 코드
- 프로세스
  - 프로그램을 구동하여 프로그램 자체와 프로그램의 상태가 메모리 상에서 실행되는 작업 단위

프로세스 과정

- OS 상에서 프로세스가 시작
  - 사용자 요청을 받을 준비 완료
- 시작 의뢰가 있으면 커널이 프로세스 작성
  - 커널에서 요청 분량만큼 메모리 할당
- 프로그램은 서버 내부의 디스크상에 설치된다.

프로세스

- 독자적인 메모리 공간 보유

스레드

- 메모리 공간 공유

||프로세스|스레드|
|:--:|:--:|:--:|
|장점|개별 처리 독립성이 높다|생성 시 부하가 낮다|
|단점|생성 시 CPU 부하가 높다|메모리 공간을 공유하기 때문에 의도하지 않는 데이터 읽기/쓰기가 발생할 수 있다.|

## OS 커널

커널의 6가지 역할

- 시스템 콜 인터페이스
  - 프로세스나 스레드로부터 명령을 받는 인터페이스
- 프로세스 관리
  - 가동되고 있는 프로세스의 관리와 CPU 이용 우선순위 등을 스케쥴링한다.
- 메모리 관리
  - 서버상의 메모리를 단위 크기의 블록으로 분할해서 프로세스에 할당한다.
- 네트워크 스택
  - 네트워크 관리
- 파일 시스템 관리
  - 파일 시스템 관리
- 장치 드라이버
  - 디스크, NIC, HBA 등의 물리 장치와 작업

### 시스템 콜 인터페이스

프로세스/스레드에서 커널로 연결되는 인터페이스

- 애플리케이션이 OS를 통해서 어떤 처리를 하고 싶으면 시스템 콜을 이용해 커널에 명령을 내린다.
  - 이 명령이 인터페이스를 통해서 커널로 전달된다.

### 프로세스 관리

언제, 어떤 프로세스가 어느 정도의 CPU 코어를 이용할 수 있는지, 처리 우선순위를 어떻게 결정할 것인지 등을 관리하는 것

### 메모리 관리

물리 메모리 공간의 최대치를 고려하여 관리한다.

- 프로세스가 이용하는 독립 메모리 공간을 확보
- 상호 간의 참조 영역을 지키기 위해 독립성을 관리
- 이 기능이 없다면 각 프로세스는 자신 이외의 프로세스가 사용하고 있는 메모리 영역 범위를 직접 파악해야 한다.

### 파일 시스템 관리

물리 디스크에 제공된 데이터를 관리하는 기능

이 기능 덕분에 0과 1로 구성된 데이터를 '파일'이라는 단위로 관리한다.

### 장치 드라이버

물리 장치용 인터페이스 제공

- 각 물리 장치의 제조사가 OS에 대응하는 장치 드라이버를 제공해 해당 OS의 커널을 경유해 이용할 수 있게 하는 것

---

# 웹 데이터의 흐름

## 클라이언트 PC부터 웹 서버까지

전체 흐름

- 웹 브라우저가 특정 사이트에 요청을 발행
- 이름 해석(Name resolution)
  - 해당 사이트가 어디에 위치해 있는지 이름을 해석하고 그 결과로 해당 '웹 서버'에 요청한다.
  - 웹 브라우저가 입력된 URL의 IP 주소를 모를 경우
    - 외부 DNS 서버에 요청을 던진다.
      - DNS 서버는 Root DNS를 기준으로 트리 구조
        - 개별 DNS 서버는 정기적으로 부모 DNS 서버에서 데이터를 받아 최신 IP 주소 목록을 유지한다.
- 웹 서버가 요청을 접수
  - 웹 서버의 'httpd' 프로세스가 요청을 접수
- 웹 서버가 정적 콘텐츠인지 동적 콘텐츠인지를 판단
- 필요한 경로로 데이터에 액세스
  - 정적 콘텐츠
    - 디스크로부터 읽는다.
    - 갱신 빈도가 낮은 데이터는 디스크에 저장한다.
  - 동적 콘텐츠
    - 네트워크를 경유해서 다른 서버에 요청을 보낸다.
    - 갱신 빈도가 높은 동적 콘텐츠는 서버 내부 디스크에 저장한다면 디스크 성능이 병목 현상의 원인이 될 수 있다.
    - 일반적으로 동적 콘텐츠는 AP서버가 HTML 파일을 동적으로 생성한 것이다.
      - 그래서 웹 서버는 동적 콘텐츠에 대한 요청을 AP 서버에게 던지고 결과를 기다린다.

웹 서버에는 HTTP를 처리할 수 있는 httpd 프로세스가 가동되고 있다.

## 웹 서버부터 AP 서버까지

전체 흐름

- 웹 서버로부터 요청이 도착
  - NIC를 경유해 커널에 의해 끼어들기 처리된다.
- 스레드가 요청을 접수
  - 자신이 계산할 수 있는지, DB 접속이 필요한지를 판단
  - 자신이 직접 계산할 수 있으면 계산 후 결과를 반환
- DB 접속이 필요하면 연결 풀에 액세스
  - DB에 보내는 접속 요청도 시스템 콜 이용
- DB 서버에 요청을 던진다.
  - 네트워크 경유
  - 결과를 HTML 등으로 정리해서 반환

AP 서버

- 동적 콘텐츠에 대한 요청을 처리
- 아직 존재하지 않는 콘텐츠를 빨리 만들어 내야 한다.
- 단순한 계산 요청은 AP 서버의 담당 스레드가 계산한 후 결과를 반환

## AP 서버부터 DB 서버까지

DB 서버에서의 요청은 SQL 언어 형태로 이뤄진다.

전체 흐름
- AP 서버로부터 요청 도착
- DB 프로세스가 요청을 접수하고 캐시가 있는지 확인
- 캐시에 없으면 디스크에 액세스
  - 시스템 콜을 이용
- 디스크가 데이터를 요청을 보낸 DB 프로세스로 반환
- 데이터를 캐시 형태로 저장
- 결과를 AP 서버에 반환

## AP 서버부터 웹 서버까지

전체 흐름
- DB 서버로부터 데이터가 도착
  - NIC 경유로 원래 스레드에 반환된다.
- 스레드가 데이터를 가지고 계산 등을 한 후에 파일 데이터를 생성
- 결과를 웹 서버로 반환

## 웹 서버로부터 클라이언트 PC까지

전체 흐름
- AP 서버로부터 데이터가 도착
  - NIC 경유로 원래 스레드에 반환된다.
- 프로세스는 받은 데이터를 그대로 반환
- 결과가 웹 브라우저로 반환되고 화면에 표시된다.

일반적인 웹 페이지에서는 페이지 HTML 파일과 다수의 이미지 파일 등이 있기 때문에 복수의 요청으로 분할돼서 웹 서버에 도착하고, 각 요청별로 데이터를 반환한다.

## 웹 데이터의 흐름 정리

각 서버 동작 간의 공통점
- 프로세스나 스레드가 요청을 받는다.
- 도착한 요청을 파악해서 필요에 따라 별도 서버로 요청을 보낸다.
- 도착한 요청에 대해 응답한다.

---

# 가상화

## 가상화란?

컴퓨터 시스템에서 물리 리소스를 추상화하는 것

## OS도 가상화 기술의 하나



OS에 의해 하드웨어가 추상화
- 하드웨어의 사양(메모리의 물리 주소, 하드디스크의 물리 주소 등)을 고려하지 않고 프로그램 개발 가능

OS로 가상 메모리를 사용해 프로세스 및 OS 커널의 메모리 공간을 분리
- 하나의 프로그램이 실패해도 시스템 전체에 영향을 끼치지 않는다.

## 가상 머신

호스트 OS형
- 호스트 OS에 가상화 소프트웨어를 설치해서 이용
- 소프트웨어를 에뮬레이터하는 것
  - 성능 제한

하이퍼바이저형
- 하드웨어상에서 직접 가상화 소프트웨어 실행
  - 그 위에 가상 머신을 실행
- 호스트 OS를 거치지 않아서 비교적 성능 우수
- 완전 가상화
  - 물리 머신상에서 동작하는 OS나 드라이버를 그대로 게스트로 이용할 수 있다.
  - 소프트웨어로 에뮬레이션하기 때문에 성능 저하
- 준 가상화
  - 실존하는 하드웨어를 에뮬레이션 하는 것이 아니라, 가상 환경용 가상 하드웨어를 소프트웨어적으로 에뮬레이션한다.
  - 제조사가 가상 하드웨어를 지원하는 기능을 개발함으로써 완전가상화가 상용화되었다.

## 컨테이너

리소스가 격리된 프로세스
- 각각 독립된 루트 파일 시스템, CPU/메모리, 프로세스 공간 등을 사용할 수 있다.
- 각 컨터이너가 커널 공간 공유 가능

가상머신 vs 컨테이너, 도커
- 컨테이너는 호스트 OS와 OS 커널을 공유
  - 컨테이너 실행이나 정지 속도가 빠르다.
- 호스트 OS의 커널을 공유하므로 VM만 사용하는 경우와 비교해 한 대의 호스트 머신상에서 훨씬 많은 컨테이너를 실행할 수 있다.
- 도커는 라이브러리나 프레임워크 등을 도커 이미지로 묶어서 공유할 수 있는 것
  - 특정 환경에서는 재현되지만 자신의 개발 환경에서는 재현되지 않는 문제가 발생하기 어렵다.
    - 버그를 효율적으로 수정할 수 있다.